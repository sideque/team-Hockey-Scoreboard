<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hockey Scoreboard â€” Display</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background: linear-gradient(180deg, #0F1117, #0B0C10);
      color: #fff;
    }

    .led {
      font-family: ui-monospace, "Roboto Mono", monospace;
      letter-spacing: .08em;
      text-shadow: 0 0 10px rgba(59, 130, 246, 0.9), 0 0 28px rgba(59, 130, 246, 0.25);
    }

    .big-timer {
      font-size: clamp(48px, 8vw, 128px);
    }

    .teamName {
      font-size: clamp(16px, 2vw, 28px);
      font-weight: 600;
      letter-spacing: .06em;
    }

    .referral {
      padding: 4px 8px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
    }

    /* -------------------- FULL-SCREEN MESSAGE OVERLAY -------------------- */
    #fullScreenMessage {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(180deg, #0F1117, #0B0C10);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      transform: scale(0.95);
      transition: all 0.4s ease;
      font-size: clamp(2rem, 10vw, 12rem);
      font-family: ui-monospace, "Roboto Mono", monospace;
      font-weight: font-black;
      text-align: center;
      padding: 2rem;
      box-sizing: border-box;
      color: #fff;
      letter-spacing: 0.1em;
      text-shadow: 
        0 0 20px rgba(255, 255, 255, 0.8), 
        0 0 40px rgba(59, 130, 246, 0.6), 
        0 0 60px rgba(59, 130, 246, 0.3);
    }

    #fullScreenMessage.show {
      opacity: 1;
      transform: scale(1);
    }

    /* Blink Animation */
    .blink {
      animation: blinkEffect 1s infinite;
    }

    @keyframes blinkEffect {
      0% { opacity: 1; }
      50% { opacity: 0.2; }
      100% { opacity: 1; }
    }

    /* Hide scoreboard when message is active */
    .scoreboard-content.hidden {
      display: none !important;
    }
  </style>
</head>

<body class="min-h-screen relative">

  <!-- FULL-SCREEN MESSAGE OVERLAY -->
  <div id="fullScreenMessage" class="hidden"></div>

  <!-- SCOREBOARD CONTENT -->
  <div id="scoreboardContent" class="scoreboard-content">
    <div class="max-w-7xl mx-auto py-8 px-4">

      <div class="grid grid-cols-12 gap-6 items-center">

        <!-- Team A -->
        <div class="col-span-3 bg-transparent text-left">
          <div id="displayTeamAName" class="teamName">TEAM A</div>
          <div id="displayTeamAScore" class="text-7xl led font-black mt-4">00</div>
          <div id="displayReferralA" class="mt-4 referral bg-green-600 text-black">Referral</div>
        </div>

        <!-- Center -->
        <div class="col-span-6 text-center">
          <div id="displayQuarter" class="text-sm text-gray-400 mb-2">1st Quarter</div>
          <div id="displayMainClock" class="big-timer led font-extrabold">15:00</div>

          <div class="mt-4 flex justify-center gap-6">
            <div class="text-center">
              <div class="text-xs text-gray-400">Goal Timer</div>
              <div id="displayGoal" class="led text-2xl">00:20</div>
            </div>
            <div class="text-center">
              <div class="text-xs text-gray-400">Penalty Timer</div>
              <div id="displayPenalty" class="led text-2xl">00:40</div>
            </div>
          </div>
        </div>

        <!-- Team B -->
        <div class="col-span-3 text-right">
          <div id="displayTeamBName" class="teamName">TEAM B</div>
          <div id="displayTeamBScore" class="text-7xl led font-black mt-4">00</div>
          <div id="displayReferralB" class="mt-4 referral bg-green-600 text-black">Referral</div>
        </div>
      </div>

      <!-- SHOOTOUT -->
      <div class="mt-8 bg-[#081226] p-4 rounded-lg">
        <div class="flex items-center justify-between">
          <div class="text-gray-400">Shootout</div>
          <div class="text-white led" id="displaySOScore">0 - 0</div>
        </div>

        <div id="soGrid" class="mt-4 grid grid-cols-12 gap-2 items-center"></div>
      </div>
    </div>
  </div>

  <!-- SCRIPT -->
  <script>
    (function () {
      const qs = id => document.getElementById(id);

      function load() {
        try { return JSON.parse(localStorage.getItem("scoreboardState")) || {}; }
        catch { return {}; }
      }

      const fullScreenMsg = qs("fullScreenMessage");
      const scoreboardContent = qs("scoreboardContent");

      function formatTime(seconds) {
        if (seconds == null || isNaN(seconds)) seconds = 0;
        const m = Math.floor(seconds / 60), s = seconds % 60;
        return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
      }

      function getQuarterText(quarter) {
        const suffixes = ['', 'st', 'nd', 'rd', 'th'];
        return `${quarter}${suffixes[quarter] || 'th'} Quarter`;
      }

      function updateDisplay() {
        const st = load();

        // Update Message (full-screen if present)
        const text = st.message?.text || "";
        if (text.trim()) {
          // Hide scoreboard, show message
          scoreboardContent.classList.add("hidden");
          fullScreenMsg.classList.remove("hidden");
          fullScreenMsg.textContent = text;
          requestAnimationFrame(() => fullScreenMsg.classList.add("show"));

          // Blink if enabled in message state
          if (st.message?.blink) {
            fullScreenMsg.classList.add("blink");
          } else {
            fullScreenMsg.classList.remove("blink");
          }
          return;
        } else {
          // No message: Show scoreboard, hide message
          fullScreenMsg.classList.remove("show", "blink");
          fullScreenMsg.classList.add("hidden");
          scoreboardContent.classList.remove("hidden");
        }

        // Update Scoreboard Elements
        qs("displayTeamAName").textContent = st.teamA?.name || "TEAM A";
        qs("displayTeamBName").textContent = st.teamB?.name || "TEAM B";
        qs("displayTeamAScore").textContent = String(st.teamA?.score || 0).padStart(2, '0');
        qs("displayTeamBScore").textContent = String(st.teamB?.score || 0).padStart(2, '0');
        qs("displayMainClock").textContent = formatTime(st.mainTimer?.seconds || 900);
        qs("displayGoal").textContent = formatTime(st.goalTimer?.seconds || 20);
        qs("displayPenalty").textContent = formatTime(st.penaltyTimer?.seconds || 40);
        qs("displayQuarter").textContent = getQuarterText(st.quarter || 1);
        qs("displaySOScore").textContent = `${st.shootout?.scoreA || 0} - ${st.shootout?.scoreB || 0}`;

        // Update Referrals (show/hide based on state)
        const refA = qs("displayReferralA");
        const refB = qs("displayReferralB");
        if (st.teamA?.referral) {
          refA.style.display = "block";
          refA.className = "mt-4 referral bg-green-600 text-black";
        } else {
          refA.style.display = "none";
        }
        if (st.teamB?.referral) {
          refB.style.display = "block";
          refB.className = "mt-4 referral bg-green-600 text-black";
        } else {
          refB.style.display = "none";
        }

        // Shootout Grid (basic: clear and add rounds if present; minimal for now)
        const soGrid = qs("soGrid");
        soGrid.innerHTML = ""; // Clear
        if (st.shootout?.rounds) {
          st.shootout.rounds.slice(0, 5).forEach((round, idx) => {
            const cell = document.createElement("div");
            cell.className = "col-span-1 text-center text-sm led";
            cell.textContent = `${round.a} - ${round.b}`;
            soGrid.appendChild(cell);
          });
        }
      }

      // Poll every 500ms for live updates
      setInterval(updateDisplay, 500);
      updateDisplay(); // Initial load
    })();
  </script>

</body>
</html>