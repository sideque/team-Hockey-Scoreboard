<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Shootout Control</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <style>
    .cell { min-width:56px; min-height:56px; display:flex; align-items:center; justify-content:center; border-radius:8px; }
  </style>
</head>
<body class="bg-[#071022] text-white p-6">
  <div class="max-w-3xl mx-auto">
    <h1 class="text-xl font-semibold mb-4">Shootout Control</h1>
    <div class="grid grid-cols-11 gap-2 items-center">
      <div class="text-gray-400">Round</div>
      <div class="text-center">A1</div><div class="text-center">A2</div><div class="text-center">A3</div><div class="text-center">A4</div><div class="text-center">A5</div>
      <div class="text-center">vs</div>
      <div class="text-center">B1</div><div class="text-center">B2</div><div class="text-center">B3</div><div class="text-center">B4</div><div class="text-center">B5</div>
    </div>

    <div id="grid" class="mt-4 grid grid-cols-11 gap-2"></div>

    <div class="mt-6 flex gap-3">
      <button id="resetAll" class="px-3 py-2 rounded bg-red-600">Reset Shootout</button>
      <button id="autoNext" class="px-3 py-2 rounded bg-slate-700">Auto Next Round</button>
      <div class="ml-auto text-gray-300">Score: <span id="soScore">0 - 0</span></div>
    </div>
  </div>

<script>
(function(){
  const qs = id => document.getElementById(id);
  function load(){ try{ return JSON.parse(localStorage.getItem('scoreboardState')) || {}; }catch(e){ return {}; } }
  function save(st){ localStorage.setItem('scoreboardState', JSON.stringify(st)); }

  let st = load();
  if (!st.shootout) st.shootout = { rounds:Array(5).fill().map(()=>({a:'-',b:'-'})), currentRound:0, scoreA:0, scoreB:0, suddenDeath:false };
  save(st);

  function build(){
    const grid = qs('grid'); grid.innerHTML='';
    for(let i=0;i<5;i++){
      // A cell
      const a = document.createElement('div'); a.className='cell bg-[#0f1724] p-3 text-center rounded';
      a.id = `A${i}`; a.innerHTML = `<div class="text-sm text-gray-300">A${i+1}</div><div class="text-xl" data-val>${st.shootout.rounds[i].a}</div>`;
      a.addEventListener('click', ()=> openPicker(i,'a'));
      grid.appendChild(a);
    }
    // separator for symmetry
    const sep = document.createElement('div'); sep.className='col-span-1 flex items-center justify-center text-gray-400'; sep.textContent='vs'; grid.appendChild(sep);
    for(let i=0;i<5;i++){
      const b = document.createElement('div'); b.className='cell bg-[#0f1724] p-3 text-center rounded';
      b.id = `B${i}`; b.innerHTML = `<div class="text-sm text-gray-300">B${i+1}</div><div class="text-xl" data-val>${st.shootout.rounds[i].b}</div>`;
      b.addEventListener('click', ()=> openPicker(i,'b'));
      grid.appendChild(b);
    }
    qs('soScore').textContent = `${st.shootout.scoreA} - ${st.shootout.scoreB}`;
  }

  function openPicker(round, team){
    const menu = document.createElement('div'); menu.className='fixed left-0 top-0 w-full h-full flex items-center justify-center';
    const box = document.createElement('div'); box.className='bg-[#071022] p-6 rounded shadow-lg';
    box.innerHTML = `<div class="mb-3">Round ${round+1} - Team ${team.toUpperCase()}</div>`;
    ['GOAL','NO GOAL','DEFAULT'].forEach(opt=>{
      const btn = document.createElement('button'); btn.className='px-3 py-2 m-1 rounded bg-slate-700';
      btn.textContent = opt;
      btn.addEventListener('click', ()=>{
        applyRound(round, team, opt);
        document.body.removeChild(menu);
      });
      box.appendChild(btn);
    });
    menu.appendChild(box); menu.addEventListener('click',(e)=>{ if(e.target===menu) document.body.removeChild(menu); });
    document.body.appendChild(menu);
  }

  function applyRound(round, team, opt){
    const val = (opt==='GOAL') ? 'G' : (opt==='NO GOAL' ? 'X' : '-');
    if (team==='a'){
      st.shootout.rounds[round].a = val;
    } else {
      st.shootout.rounds[round].b = val;
    }
    // recalc scores
    let sa=0,sb=0;
    for(let r of st.shootout.rounds){
      if (r.a === 'G') sa++;
      if (r.b === 'G') sb++;
    }
    st.shootout.scoreA = sa; st.shootout.scoreB = sb;
    // sudden death check after 5 rounds
    if (st.shootout.rounds.every(r=> r.a!=='-' && r.b!=='-') && st.shootout.scoreA === st.shootout.scoreB){
      st.shootout.suddenDeath = true;
    } else st.shootout.suddenDeath = false;
    save(st);
    localStorage.setItem('scoreboardState', JSON.stringify(st));
    build();
  }

  qs('resetAll').addEventListener('click', ()=>{
    if(!confirm('Reset shootout?')) return;
    st.shootout = { rounds:Array(5).fill().map(()=>({a:'-',b:'-'})), currentRound:0, scoreA:0, scoreB:0, suddenDeath:false };
    save(st); build();
  });

  let auto = false;
  qs('autoNext').addEventListener('click', ()=> {
    auto = !auto;
    qs('autoNext').textContent = auto ? 'Stop Auto' : 'Auto Next Round';
    if (auto) nextRoundLoop();
  });
  async function nextRoundLoop(){
    for(let r=0;r<5 && auto;r++){
      // place default 'GOAL' for A and then for B to simulate (this is demo automation â€” admin will manually set)
      await new Promise(res=> setTimeout(res, 700));
      if (!auto) break;
      if (st.shootout.rounds[r].a === '-') { applyRound(r,'a','NO GOAL'); }
      await new Promise(res=> setTimeout(res, 700));
      if (!auto) break;
      if (st.shootout.rounds[r].b === '-') { applyRound(r,'b','NO GOAL'); }
    }
    auto = false; qs('autoNext').textContent = 'Auto Next Round';
  }

  // listen storage changes (if admin modified other tabs)
  window.addEventListener('storage', ()=>{ st = load(); build(); });

  build();

})();
</script>
</body>
</html>
